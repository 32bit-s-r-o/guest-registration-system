{% extends "base.html" %}

{% block title %}Confirm Registration{% endblock %}

{% block content %}
<div class="form-container">
    <div class="text-center mb-4">
        <h2>Confirm Your Registration</h2>
        <h4 class="text-primary">{{ trip.title }}</h4>
        <p class="text-muted">
            <i class="fas fa-calendar"></i> {{ trip.start_date.strftime('%B %d, %Y') }} - {{ trip.end_date.strftime('%B
            %d, %Y') }}
        </p>
    </div>

    <div class="alert alert-info" role="alert">
        <h5><i class="fas fa-info-circle"></i> Please review your information</h5>
        <p class="mb-0">Please carefully review all the information below before submitting. Once submitted, you will
            receive an email confirmation and your registration will be sent for approval.</p>
    </div>

    <!-- Contact Information -->
    <div class="card mb-4">
        <div class="card-header">
            <h5><i class="fas fa-envelope"></i> Contact Information</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <strong>Email Address:</strong><br>
                    {{ data.email }}
                </div>
            </div>
        </div>
    </div>

    <!-- Guest Information -->
    <div class="card mb-4">
        <div class="card-header">
            <h5><i class="fas fa-users"></i> Guest Information</h5>
        </div>
        <div class="card-body">
            {% for guest in data.guests %}
            <div class="guest-form">
                <h6>Guest {{ loop.index }}</h6>
                <div class="row">
                    <div class="col-md-6">
                        <strong>Name:</strong><br>
                        {{ guest.first_name }} {{ guest.last_name }}
                    </div>
                    <div class="col-md-6">
                        <strong>Document:</strong><br>
                        {{ guest.document_type|title }} - {{ guest.document_number }}
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-md-6">
                        <strong>GDPR Consent:</strong><br>
                        <span class="badge bg-{{ 'success' if guest.gdpr_consent else 'danger' }}">
                            {{ 'Yes' if guest.gdpr_consent else 'No' }}
                        </span>
                    </div>
                    <div class="col-md-6">
                        <strong>Document Uploaded:</strong><br>
                        <span class="badge bg-success">
                            <i class="fas fa-check"></i> Yes
                        </span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Invoice Request Information -->
    {% if data.invoice_request %}
    <div class="card mb-4">
        <div class="card-header bg-success text-white">
            <h5><i class="fas fa-file-invoice"></i> Invoice Request</h5>
        </div>
        <div class="card-body">
            <div class="alert alert-success">
                <i class="fas fa-check-circle"></i>
                <strong>Invoice Requested:</strong> A draft invoice will be created for your registration.
            </div>

            {% if data.invoice_data.company_name %}
            <div class="row mb-2">
                <div class="col-md-6">
                    <strong>Company Name:</strong><br>
                    {{ data.invoice_data.company_name }}
                </div>
                {% if data.invoice_data.vat_number %}
                <div class="col-md-6">
                    <strong>VAT Number:</strong><br>
                    {{ data.invoice_data.vat_number }}
                </div>
                {% endif %}
            </div>
            {% endif %}

            {% if data.invoice_data.address %}
            <div class="row mb-2">
                <div class="col-12">
                    <strong>Billing Address:</strong><br>
                    {{ data.invoice_data.address | nl2br }}
                </div>
            </div>
            {% endif %}

            <div class="row mb-2">
                <div class="col-md-6">
                    <strong>Preferred Currency:</strong><br>
                    {{ data.invoice_data.currency }}
                </div>
                {% if data.invoice_data.notes %}
                <div class="col-md-6">
                    <strong>Additional Notes:</strong><br>
                    {{ data.invoice_data.notes }}
                </div>
                {% endif %}
            </div>

            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                <strong>Note:</strong> The admin will review your registration and complete the invoice with pricing
                details.
                You will be notified when the invoice is ready.
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Important Notice -->
    <div class="alert alert-warning" role="alert">
        <h5><i class="fas fa-exclamation-triangle"></i> Important Notice</h5>
        <ul class="mb-0">
            <li>By submitting this registration, you confirm that all information provided is accurate and complete.
            </li>
            <li>Your uploaded documents will be automatically deleted after approval for GDPR compliance.</li>
            <li>You will receive an email notification once your registration has been reviewed.</li>
            <li>If any information is incorrect, you may be asked to resubmit with corrections.</li>
        </ul>
    </div>

    <!-- Action Buttons -->
    <div class="d-grid gap-2 d-md-flex justify-content-md-between">
        <a href="{{ url_for('register', trip_id=trip.id) }}" class="btn btn-secondary btn-lg">
            <i class="fas fa-arrow-left"></i> Go Back and Edit
        </a>
        <form method="POST" action="{{ url_for('submit_for_approval') }}" style="display: inline;">
            <button type="submit" class="btn btn-success btn-lg">
                <i class="fas fa-check"></i> Submit for Approval
            </button>
        </form>
    </div>
</div>
{% endblock %}